{% extends 'internal/processes/base.html' %}

{% block page_title %}{{ action }} Tarea - {{ template.name }}{% endblock %}

{% block page_actions %}
<a href="{% url 'internal:processes:template_detail' template.id %}" class="btn btn-secondary">
    <i class="fas fa-arrow-left me-1"></i> Volver a Plantilla
</a>
{% endblock %}

{% block content %}
<div class="card">
    <div class="card-header">
        <h5 class="mb-0">{{ action }} Tarea</h5>
    </div>
    <div class="card-body">
        <form method="post">
            {% csrf_token %}

            <!-- Información Básica -->
            <h6 class="border-bottom pb-2 mb-3">Información Básica</h6>

            <div class="row">
                <div class="col-md-8">
                    <div class="mb-3">
                        <label for="{{ form.task_title.id_for_label }}" class="form-label">
                            {{ form.task_title.label }}
                            {% if form.task_title.field.required %}<span class="text-danger">*</span>{% endif %}
                        </label>
                        {{ form.task_title }}
                        {% if form.task_title.errors %}
                            <div class="invalid-feedback d-block">{{ form.task_title.errors.0 }}</div>
                        {% endif %}
                        {% if form.task_title.help_text %}
                            <small class="form-text text-muted">{{ form.task_title.help_text }}</small>
                        {% endif %}
                    </div>
                </div>

                <div class="col-md-4">
                    <div class="mb-3">
                        <label for="{{ form.execution_order.id_for_label }}" class="form-label">
                            {{ form.execution_order.label }}
                            {% if form.execution_order.field.required %}<span class="text-danger">*</span>{% endif %}
                        </label>
                        {{ form.execution_order }}
                        {% if form.execution_order.errors %}
                            <div class="invalid-feedback d-block">{{ form.execution_order.errors.0 }}</div>
                        {% endif %}
                        {% if form.execution_order.help_text %}
                            <small class="form-text text-muted">{{ form.execution_order.help_text }}</small>
                        {% endif %}
                    </div>
                </div>
            </div>

            <div class="mb-3">
                <label for="{{ form.task_description.id_for_label }}" class="form-label">
                    {{ form.task_description.label }}
                </label>
                {{ form.task_description }}
                {% if form.task_description.errors %}
                    <div class="invalid-feedback d-block">{{ form.task_description.errors.0 }}</div>
                {% endif %}
                {% if form.task_description.help_text %}
                    <small class="form-text text-muted">{{ form.task_description.help_text }}</small>
                {% endif %}
            </div>

            <!-- Configuración de Ejecución -->
            <h6 class="border-bottom pb-2 mb-3 mt-4">Configuración de Ejecución</h6>

            <div class="row">
                <div class="col-md-4">
                    <div class="mb-3">
                        <label for="{{ form.task_type.id_for_label }}" class="form-label">
                            {{ form.task_type.label }}
                            {% if form.task_type.field.required %}<span class="text-danger">*</span>{% endif %}
                        </label>
                        {{ form.task_type }}
                        {% if form.task_type.errors %}
                            <div class="invalid-feedback d-block">{{ form.task_type.errors.0 }}</div>
                        {% endif %}
                        {% if form.task_type.help_text %}
                            <small class="form-text text-muted">{{ form.task_type.help_text }}</small>
                        {% endif %}
                    </div>
                </div>

                <div class="col-md-4">
                    <div class="mb-3">
                        <label for="{{ form.priority.id_for_label }}" class="form-label">
                            {{ form.priority.label }}
                            {% if form.priority.field.required %}<span class="text-danger">*</span>{% endif %}
                        </label>
                        {{ form.priority }}
                        {% if form.priority.errors %}
                            <div class="invalid-feedback d-block">{{ form.priority.errors.0 }}</div>
                        {% endif %}
                        {% if form.priority.help_text %}
                            <small class="form-text text-muted">{{ form.priority.help_text }}</small>
                        {% endif %}
                    </div>
                </div>

                <div class="col-md-4">
                    <div class="mb-3">
                        <label for="{{ form.estimated_hours.id_for_label }}" class="form-label">
                            {{ form.estimated_hours.label }}
                        </label>
                        {{ form.estimated_hours }}
                        {% if form.estimated_hours.errors %}
                            <div class="invalid-feedback d-block">{{ form.estimated_hours.errors.0 }}</div>
                        {% endif %}
                        {% if form.estimated_hours.help_text %}
                            <small class="form-text text-muted">{{ form.estimated_hours.help_text }}</small>
                        {% endif %}
                    </div>
                </div>
            </div>

            <!-- Fechas y Dependencias -->
            <h6 class="border-bottom pb-2 mb-3 mt-4">Fechas y Dependencias</h6>

            <div class="row">
                <div class="col-md-6">
                    <div class="mb-3">
                        <label for="{{ form.due_date_offset_days.id_for_label }}" class="form-label">
                            {{ form.due_date_offset_days.label }}
                            {% if form.due_date_offset_days.field.required %}<span class="text-danger">*</span>{% endif %}
                        </label>
                        {{ form.due_date_offset_days }}
                        {% if form.due_date_offset_days.errors %}
                            <div class="invalid-feedback d-block">{{ form.due_date_offset_days.errors.0 }}</div>
                        {% endif %}
                        {% if form.due_date_offset_days.help_text %}
                            <small class="form-text text-muted">{{ form.due_date_offset_days.help_text }}</small>
                        {% endif %}
                    </div>
                </div>

                <div class="col-md-6">
                    <div class="mb-3">
                        <label for="{{ form.depends_on.id_for_label }}" class="form-label">
                            {{ form.depends_on.label }}
                        </label>
                        {{ form.depends_on }}
                        {% if form.depends_on.errors %}
                            <div class="invalid-feedback d-block">{{ form.depends_on.errors.0 }}</div>
                        {% endif %}
                        {% if form.depends_on.help_text %}
                            <small class="form-text text-muted">{{ form.depends_on.help_text }}</small>
                        {% endif %}
                    </div>
                </div>
            </div>

            <!-- Opciones -->
            <h6 class="border-bottom pb-2 mb-3 mt-4">Opciones</h6>

            <div class="row">
                <div class="col-md-4">
                    <div class="form-check mb-3">
                        {{ form.is_optional }}
                        <label class="form-check-label" for="{{ form.is_optional.id_for_label }}">
                            {{ form.is_optional.label }}
                        </label>
                        {% if form.is_optional.help_text %}
                            <small class="form-text text-muted d-block ms-4">{{ form.is_optional.help_text }}</small>
                        {% endif %}
                    </div>
                </div>

                <div class="col-md-4">
                    <div class="form-check mb-3">
                        {{ form.can_run_parallel }}
                        <label class="form-check-label" for="{{ form.can_run_parallel.id_for_label }}">
                            {{ form.can_run_parallel.label }}
                        </label>
                        {% if form.can_run_parallel.help_text %}
                            <small class="form-text text-muted d-block ms-4">{{ form.can_run_parallel.help_text }}</small>
                        {% endif %}
                    </div>
                </div>

                <div class="col-md-4">
                    <div class="form-check mb-3">
                        {{ form.due_date_from_previous }}
                        <label class="form-check-label" for="{{ form.due_date_from_previous.id_for_label }}">
                            {{ form.due_date_from_previous.label }}
                        </label>
                        {% if form.due_date_from_previous.help_text %}
                            <small class="form-text text-muted d-block ms-4">{{ form.due_date_from_previous.help_text }}</small>
                        {% endif %}
                    </div>
                </div>
            </div>

            <!-- Acción del Formulario -->
            <div class="mt-4">
                <button type="submit" class="btn btn-primary">
                    <i class="fas fa-save me-1"></i> Guardar Tarea
                </button>
                <a href="{% url 'internal:processes:template_detail' template.id %}" class="btn btn-secondary ms-2">
                    Cancelar
                </a>
            </div>
        </form>
    </div>
</div>
{% endblock %}
